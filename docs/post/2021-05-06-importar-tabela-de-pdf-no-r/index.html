<!DOCTYPE html>
<html lang="pt_br" data-theme=""><head>
    <title> Denis Rodrigues | Importar tabela de dentro um arquivo PDF para o R </title>

    
    <meta charset="utf-8"><meta name="generator" content="Hugo 0.82.0" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta name="description" content="Exemplo de uso do Tabulizer ">
    
    <link rel="stylesheet"
          href="https://denis-or.com.br/css/style.min.0539a996fdd335cb2cbe4b57f488464bbc5598963be67125cb2a45189c8855ec.css"
          integrity="sha256-BTmplv3TNcssvktX9IhGS7xVmJY75nElyypFGJyIVew="
          crossorigin="anonymous"
          type="text/css">
    
    <link rel="stylesheet"
        href="https://denis-or.com.br/css/markupHighlight.min.f798cbda9aaa38f89eb38be6414bd082cfd71a6780375cbf67b6d2fb2b96491e.css"
        integrity="sha256-95jL2pqqOPies4vmQUvQgs/XGmeAN1y/Z7bS&#43;yuWSR4="
        crossorigin="anonymous"
        type="text/css">
    
        
        
        <link rel="stylesheet"
        href="https://denis-or.com.br/css/resume_adap.min.4760408459b1b5dcd81717bc97f4e34464409eccc52e2c22a81df3c9cedde610.css"
        integrity="sha256-R2BAhFmxtdzYFxe8l/TjRGRAnszFLiwiqB3zyc7d5hA="
        crossorigin="anonymous"
        media="screen" />
    
        
        
        <link rel="stylesheet"
        href="https://denis-or.com.br/css/style.min.0539a996fdd335cb2cbe4b57f488464bbc5598963be67125cb2a45189c8855ec.css"
        integrity="sha256-BTmplv3TNcssvktX9IhGS7xVmJY75nElyypFGJyIVew="
        crossorigin="anonymous"
        media="screen" />
    
    <link rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" 
    integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" 
    crossorigin="anonymous" />

    
    <link rel="shortcut icon" href="https://denis-or.com.br/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="https://denis-or.com.br/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://denis-or.com.br/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://denis-or.com.br/favicon-16x16.png">

    <link rel="canonical" href="https://denis-or.com.br/post/2021-05-06-importar-tabela-de-pdf-no-r/">

    
    
    
    
    <script type="text/javascript"
            src="https://denis-or.com.br/js/anatole-header.min.0c05c0a90d28c968a1cad4fb31abd0b8e1264e788ccefed022ae1d3b6f627514.js"
            integrity="sha256-DAXAqQ0oyWihytT7MavQuOEmTniMzv7QIq4dO29idRQ="
            crossorigin="anonymous"></script>


    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Importar tabela de dentro um arquivo PDF para o R"/>
<meta name="twitter:description" content="Exemplo de uso do Tabulizer "/>


    

</head>
<body><div class="sidebar . ">
    <div class="logo-title">
        <div class="title">
            <img src="https://denis-or.com.br/images/pp.jpg" alt="profile picture">
            <h3 title=""><a href="/">Denis OR</a></h3>
            <div class="description">
                <p>Geógrafo, Doutorando e Mestre em Epidemiologia em Saúde Pública pela Escola Nacional de Saúde Pública - ENSP/FIOCRUZ. Experiência na área de Saúde Pública, com ênfase em Epidemiologia e Vigilância em Saúde.</p>
            </div>
        </div>
    </div>
    <ul class="social-links">
        
            <li>
                <a href="https://www.linkedin.com/in/denis-or/" rel="me" aria-label="Linkedin">
                    <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://orcid.org/0000-0003-3748-876X" rel="me" aria-label="Orcid">
                    <i class="fab fa-orcid fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="http://lattes.cnpq.br/7838408308841051" rel="me" aria-label="lattes">
                    <i class="fas fa-graduation-cap fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://github.com/denis-or" rel="me" aria-label="GitHub">
                    <i class="fab fa-github fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://www.instagram.com/catoper.mg/" rel="me" aria-label="instagram">
                    <i class="fab fa-instagram fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://twitter.com/Catoper" rel="me" aria-label="twitter">
                    <i class="fab fa-twitter fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="mailto:catoper@gmail.com" rel="me" aria-label="e-mail">
                    <i class="fas fa-envelope fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
    
    <div class="description_google">
        <p>Translator/Tradutor</p>
        <div id = "google_translate_element"></div>
            <script>
              function googleTranslateElementInit() {
                        new google.translate.TranslateElement({
                            pageLanguage: 'pt',
                            autoDisplay: 'true',
                             layout: google.translate.TranslateElement.InlineLayout.VERTICAL
                        }, 'google_translate_element');
                    }
             </script>
            <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit">

            </script>
    </div>


    <div class="footer">
        <div class="by_farbox">&copy; Denis Rodrigues  2022 </div>
    </div>
</div>
<div class="main">
    <div class="page-top  . ">
    <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
    </a>
    <ul class="nav" id="navMenu">
        
        
            
            <li><a 
                   href="/"
                        
                   title="">Inicio</a></li>
        
            
            <li><a 
                   href="/post/"
                        
                   title="">Blog</a></li>
        
            
            <li><a 
                   href="/apps/"
                        
                   title="">Aplicações</a></li>
        
            
            <li><a 
                   href="/cv_/"
                        
                   title="">Currículo</a></li>
        
            
            <li><a 
                   href="/experience/"
                        
                   title="">Experiência Profissional</a></li>
        
            
            <li><a 
                   href="/contact/"
                        
                   title="">Contato</a></li>
        
            
            <li><a 
                   href="/about/"
                        
                   title="">Sobre</a></li>
        
        
        
    </ul>
</div>

    <div class="autopagerize_page_element">
        <div class="content">
    <div class="post  . ">
        <div class="post-content">
            
            <div class="post-title">
                <h3>Importar tabela de dentro um arquivo PDF para o R</h3>
                
                    <div class="info">
                        <em class="fas fa-calendar-day"></em>
                        <span class="date"> Thu,6 May, 2021
                                           </span>
                        <em class="fas fa-stopwatch"></em>
                        <span class="reading-time"></span>
                    </div>
                
            </div>

            
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>
<link href="/rmarkdown-libs/lightable/lightable.css" rel="stylesheet" />


<p>É muito comum, termos a necessidade de extrair alguma informação de um PDF, seja de dados brutos ou de tabelas. Não raras vezes, dá errado. O pacote <code>tabulizer</code> é um pacote da linguagem R, disponível no <a href="https://cran.r-project.org/package=tabulizer" title="Link para a página do pacote no CRAN do R">CRAN</a> desde 2018. <a href="https://blog.curso-r.com/posts/2021-01-08-tabulizer/" title="Link para post no blog da Curso-R">O pessoal da Curso-R fez um post sobre este pacote também</a>. Sugiro conferirem, até para entenderem a instalação, pois o pacote utiliza a biblioteca `Tabula` para extrair tabelas de PDF e depende do `rJava` e, por isso, pode ocorrer alguns errinhos marotos.</p>
<p>Bom, nosso intuito aqui é apenas brincar com o pacote e ter uma lista de ferramentas úteis no dia-a-dia do epidemiologista. Embora nosso exemplo seja para área ambiental. Prometo atualizar este post e corrigir este detalhe ou gerar mais um post utilizando algum arquivo de boletim do Ministério da Saúde ou Secretaria Estadual. Juro!</p>
<p>Nosso primeiro passo é carregar algumas bibliotecas úteis.</p>
<pre class="r"><code>library(dplyr)
library(magrittr)
library(ggplot2)
library(patchwork)
library(tabulizer)</code></pre>
<p>Vamos utilizar para o exercício, este pdf disponível anualmente no site</p>
<pre class="r"><code>url &lt;- &#39;https://www.bp.com/content/dam/bp/business-sites/en/global/corporate/pdfs/energy-economics/statistical-review/bp-stats-review-2021-co2-emissions.pdf&#39;</code></pre>
<p>Função do <code>Tabulizer</code>: a <code>extract_tables</code>. É aqui que a mágica acontece. Note que alguns <em>warnings</em> ocorrem. Talvez, se tivéssemos o download do arquivo e depois a importação com o <code>Tabulizer</code>, isso não aconteceria.</p>
<pre class="r"><code>crude_out &lt;- tabulizer::extract_tables(url, pages = 2, output = &quot;data.frame&quot;)</code></pre>
<p>O objeto <code>crude_out</code> é uma lista contendo a estrutura da tabela extraída do <em>PDF</em>. Vamos transformar esta estrutura em um dataframe e analisá-la melhor. O primeiro objeto da lista já é nossa tabela.</p>
<pre class="r"><code>df_out &lt;- as.data.frame(crude_out[[1]])</code></pre>
<p>E aqui temos um ponto interessante. Ao extrairmos a tabela, é possível notar que algumas configurações vêm estranhas. Poderíamos chamar de desconfiguradas. Mas é normal, pois a formatação das tabelas, geralmente, incluem células mescladas, por exemplo. Logo, ao tentarmos encaixá-la em uma estrutura de linhas e colunas, digamos, normal, temos estas dificuldades.</p>
<p>Analisando a tabela, percebemos que o cabeçalho está estranho (em amarelo). Vamos nos concentrar na segunda linha, pois faremos dela, o cabeçalho da nossa tabela. A primeira linha vamos excluí-la.</p>
<pre class="r"><code>kableExtra::kbl(head(df_out[1:5]))|&gt;
  kableExtra::kable_paper(
    bootstrap_options = c(&quot;striped&quot;,
                          &quot;hover&quot;,
                          &quot;condensed&quot;),
    full_width = F,
    position = &quot;center&quot;
  )|&gt;
  kableExtra::row_spec(c(1:2), background = &quot;yellow&quot;)</code></pre>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
X
</th>
<th style="text-align:right;">
X.1
</th>
<th style="text-align:right;">
X.2
</th>
<th style="text-align:right;">
X.3
</th>
<th style="text-align:right;">
X.4
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;background-color: yellow !important;">
</td>
<td style="text-align:right;background-color: yellow !important;">
NA
</td>
<td style="text-align:right;background-color: yellow !important;">
NA
</td>
<td style="text-align:right;background-color: yellow !important;">
NA
</td>
<td style="text-align:right;background-color: yellow !important;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;background-color: yellow !important;">
Million tonnes of carbon dioxide
</td>
<td style="text-align:right;background-color: yellow !important;">
2010.0
</td>
<td style="text-align:right;background-color: yellow !important;">
2011.0
</td>
<td style="text-align:right;background-color: yellow !important;">
2012.0
</td>
<td style="text-align:right;background-color: yellow !important;">
2013.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Canada
</td>
<td style="text-align:right;">
550.1
</td>
<td style="text-align:right;">
554.7
</td>
<td style="text-align:right;">
551.1
</td>
<td style="text-align:right;">
564.6
</td>
</tr>
<tr>
<td style="text-align:left;">
Mexico
</td>
<td style="text-align:right;">
454.8
</td>
<td style="text-align:right;">
473.0
</td>
<td style="text-align:right;">
476.7
</td>
<td style="text-align:right;">
483.2
</td>
</tr>
<tr>
<td style="text-align:left;">
US
</td>
<td style="text-align:right;">
5495.0
</td>
<td style="text-align:right;">
5348.4
</td>
<td style="text-align:right;">
5101.5
</td>
<td style="text-align:right;">
5268.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Total North America
</td>
<td style="text-align:right;">
6499.9
</td>
<td style="text-align:right;">
6376.1
</td>
<td style="text-align:right;">
6129.4
</td>
<td style="text-align:right;">
6316.1
</td>
</tr>
</tbody>
</table>
<p>Para isso, vamos utilizar a função <code>colnames</code>.</p>
<pre class="r"><code>colnames(df_out) &lt;- df_out[2,]

kableExtra::kbl(head(df_out[1:5])) |&gt;
  kableExtra::kable_paper(
    bootstrap_options = c(&quot;striped&quot;,
                          &quot;hover&quot;,
                          &quot;condensed&quot;),
    full_width = F,
    position = &quot;center&quot;
  )</code></pre>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Million tonnes of carbon dioxide
</th>
<th style="text-align:right;">
2010
</th>
<th style="text-align:right;">
2011
</th>
<th style="text-align:right;">
2012
</th>
<th style="text-align:right;">
2013
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Million tonnes of carbon dioxide
</td>
<td style="text-align:right;">
2010.0
</td>
<td style="text-align:right;">
2011.0
</td>
<td style="text-align:right;">
2012.0
</td>
<td style="text-align:right;">
2013.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Canada
</td>
<td style="text-align:right;">
550.1
</td>
<td style="text-align:right;">
554.7
</td>
<td style="text-align:right;">
551.1
</td>
<td style="text-align:right;">
564.6
</td>
</tr>
<tr>
<td style="text-align:left;">
Mexico
</td>
<td style="text-align:right;">
454.8
</td>
<td style="text-align:right;">
473.0
</td>
<td style="text-align:right;">
476.7
</td>
<td style="text-align:right;">
483.2
</td>
</tr>
<tr>
<td style="text-align:left;">
US
</td>
<td style="text-align:right;">
5495.0
</td>
<td style="text-align:right;">
5348.4
</td>
<td style="text-align:right;">
5101.5
</td>
<td style="text-align:right;">
5268.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Total North America
</td>
<td style="text-align:right;">
6499.9
</td>
<td style="text-align:right;">
6376.1
</td>
<td style="text-align:right;">
6129.4
</td>
<td style="text-align:right;">
6316.1
</td>
</tr>
</tbody>
</table>
<p>Depois, deletamos as linhas e colunas indesejadas e arrumamos as colunas e formato.</p>
<pre class="r"><code>df_co2_w &lt;- df_out[3:85, 1:12]
df_var_co2 &lt;- df_out[3:85, 13:14]

df_var_co2 &lt;- tidyr::separate(
  df_var_co2,
  col = c(`2020 2009-19`),
  into = c(&quot;2020&quot;, &quot;2009-19&quot;),
  sep = &quot; &quot;
) |&gt;
  tibble::add_column(var_2020 = df_var_co2$`2020`)</code></pre>
<p>A partir daqui, vamos focar em alguns países. De forma arbitrária.</p>
<pre class="r"><code>grupo_pais &lt;- c(&quot;Brazil&quot;,&quot;US&quot;,&quot;Canada&quot;,&quot;Sweden&quot;,
                &quot;Russian Federation&quot;,
                &quot;China&quot;,&quot;Japan&quot;,&quot;South Africa&quot;)</code></pre>
<pre class="r"><code>df_co2_l &lt;- df_co2_w |&gt;
  tidyr::pivot_longer(cols = &quot;2010&quot;:&quot;2020&quot;,
                      names_to = &quot;Ano&quot;,
                      values_to = &quot;CO2_MT&quot;) |&gt;
  dplyr::rename(Pais = `Million tonnes of carbon dioxide`) |&gt;
  dplyr::filter(!stringr::str_detect(Pais, &quot;Total|Non|which|Other|European Union&quot;)) |&gt;
  dplyr::mutate(Ano = as.integer(Ano)) |&gt;
  dplyr::arrange(desc(CO2_MT))</code></pre>
<p>Vamos visualizar em um gráfico, o que conseguimos extrair da tabela.</p>
<pre class="r"><code>df_co2_l |&gt;
  ggplot2::ggplot(ggplot2::aes(
    Ano,
    CO2_MT,
    group = Pais, 
    color = Pais)) +
  ggplot2::geom_line(show.legend = F) +
  ggplot2::geom_point(size = 2, show.legend = F) +
  ggplot2::geom_text(
    data = dplyr::filter(df_co2_l, Ano == 2020),
    ggplot2::aes(label = Pais, color = Pais),
    hjust = 0,
    nudge_x = 0.1,
    fontface = &quot;bold&quot;,
    size = 3,
    show.legend = F
  ) +
  ggplot2::scale_y_log10() +
  ggplot2::scale_x_continuous(breaks = seq(2010, 2020, 1),
                              expand = c(0.01, 0)) +
  ggplot2::expand_limits(x = 2022) +
  ggplot2::theme_minimal() +
  ggplot2::theme(plot.margin = ggplot2::unit(c(0.35, 2, 0.3, 0.35), &quot;cm&quot;))</code></pre>
<p><img src="/post/2021-05-06-importar-tabela-de-pdf-no-r/index.pt_br_files/figure-html/unnamed-chunk-10-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>Não ficou muito bom. Vamos separar os cinco primeiros dos cinco últimos.</p>
<pre class="r"><code>top_five &lt;- df_co2_l |&gt;
  dplyr::filter(Ano == 2020) |&gt;
  head(5) |&gt;
  dplyr::pull(Pais)

top_bottom &lt;- df_co2_l |&gt;
  dplyr::filter(Ano == 2020) |&gt;
  tail(5) |&gt;
  dplyr::pull(Pais)

gg1 &lt;-  ggplot2::ggplot(data =  dplyr::filter(df_co2_l, Pais %in% top_five),
               ggplot2::aes(Ano, CO2_MT, group = Pais, color = Pais)) +
   ggplot2::geom_line() +
   ggplot2::geom_point(size = 2) +
   ggplot2::labs(color = &quot;Top five&quot;) +
   ggplot2::theme_minimal()

gg2 &lt;-  ggplot2::ggplot(data = dplyr::filter(df_co2_l, Pais %in% top_bottom),
               ggplot2::aes(Ano, CO2_MT, group = Pais, color = Pais)) +
   ggplot2::geom_line() +
   ggplot2::geom_point(size = 2) +
   ggplot2::labs(color = &quot;Bottom five&quot;) +
   ggplot2::theme_minimal()

gg1/gg2</code></pre>
<p><img src="/post/2021-05-06-importar-tabela-de-pdf-no-r/index.pt_br_files/figure-html/unnamed-chunk-11-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>Parece que agora ficou um pouco melhor. Contudo a ideia era falar sobre o uso do pacote que extrai a tabela do PDF. Ele ainda tem várias funcionalidades bacanerrímas. Precisa explorá-lo.</p>
<p>Bom trabalho!</p>
</div>
        <div class="post-footer">
            <div class="info">
                <span class="separator"><a class="category" href="/categories/r/">R</a><a class="category" href="/categories/visualiza%C3%A7%C3%A3o-de-dados/">Visualização de dados</a><a class="category" href="/categories/tabulizer/">tabulizer</a><a class="category" href="/categories/janitor/">janitor</a><a class="category" href="/categories/dplyr/">dplyr</a><a class="category" href="/categories/ggplot2/">ggplot2</a><a class="category" href="/categories/rstats/">rstats</a></span>
                
            </div>
        </div>

        
    </div>


        </div>
    </div>
</div>

<script type="text/javascript"
        src="https://denis-or.com.br/js/medium-zoom.min.2d6fd0be87fa98f0c9b4dc2536b312bbca48757f584f6ea1f394abc9bcc38fbc.js"
        integrity="sha256-LW/Qvof6mPDJtNwlNrMSu8pIdX9YT26h85SrybzDj7w="
        crossorigin="anonymous"></script><link rel="stylesheet"
              href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"
              integrity="sha384-t5CR&#43;zwDAROtph0PXGte6ia8heboACF9R5l/DiY&#43;WZ3P2lxNgvJkQk5n7GPvLMYw"
              crossorigin="anonymous"><script defer
                src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js"
                integrity="sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8&#43;w2LAIftJEULZABrF9PPFv&#43;tVkH"
                crossorigin="anonymous"></script><script defer
                src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js"
                integrity="sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB&#43;w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v"
                crossorigin="anonymous"
                onload="renderMathInElement(document.body);"></script></body>

</html>
